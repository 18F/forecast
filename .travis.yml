sudo: required
language: python
python:
- '3.4'
- '3.5'
env:
  global:
  - CF_USERNAME=18f-acq_deployer
  - secure: "MiL6lWsz7Hl73w5w1WfdSYg1n9nw2t+SytK1K+8rwqfOGXbHPN3ywama5XmcjP7et9V4cjaIKQVUA7MPnnR/BTZq0g1Cgr4JRUM64y4biL2d5iWhkYE4ejTKwx/oRPqmynDTXd5lBZdGOWc4xsgT2UajQ/ArzV09RAeittV1IKbog7d6yU9WjbZrPeJ2vLiOhIdkBYAEj9Ludn2VeRW2y34kNH5EFV/y7Sgms7MFvnhSpHCNTuSYkfwtWqoNMyHjQ/ETwICCmxDUd+TapUx+MeiVt1AhxQN9TUaKb8KQ9saqgjUDz7FJzt5ZFPsk88BZBWVpOhYZMz8pUWWc3mE7YkpfC7DKZCjtMnaLxEdq5xJOc1SNZrB1V+c3Sn5WMK6OhsG5RqFtsZfuDQDB2Hviw+JTYZpNUck14rmG4s5NrIst4YuKG9BdOsBnAPdip8SyHyNcjwk78pBhrJ/cmoHkv31TO5s+R2H91xSxtm6AuB8SwDsBOzzr97iySUrQrnWGzHJm+XKo8+efNyah4gixE9eiDQ7xS6gV2H2Y6iegTMIj0JfO6C5znMMb/+H0JI+YI6L2JxG2GdfWoPdS6LV8OMyVREAajFTphc29fX12Q5NE03B1cEmU82Rd8yb0vk+w2gW0eSQ+srADN2YJhm70uU1dInMekBbGMBFech+2vu4="
addons:
  postgresql: "9.4"
before_install:
- pip install codecov
- psql -c 'create database "forecast-test";' -U postgres
install: pip install -r requirements.txt
cache:
  directories:
  - "$HOME/.cache/pip"
before_deploy:
- export PATH=$HOME:$PATH
- travis_retry curl -L -o $HOME/cf.tgz "https://cli.run.pivotal.io/stable?release=linux64-binary&version=6.15.0"
- tar xzvf $HOME/cf.tgz -C $HOME
- mkdir -p ${HOME}/Godeps/_workspace
- export GOPATH=${HOME}/Godeps/_workspace
- go get github.com/concourse/autopilot
- cf install-plugin -f $GOPATH/bin/autopilot
deploy:
- provider: script
  script: "./deploy.sh staging"
  skip_cleanup: true
  on:
    branch: develop
- provider: script
  script: "./deploy.sh production"
  skip_cleanup: true
  on:
    branch: master
script: cd forecast-admin/forecast && py.test --cov opportunities --cov-report term-missing && cd ../..
after_success:
- codecov
- coveralls
